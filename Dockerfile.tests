FROM golang:1.13

ARG application
ENV APPLICATION ${application}

COPY go-tests.sh /go/src/github.com/chadgrant/go-tests.sh
RUN go get -u github.com/jstemmer/go-junit-report && \
    chmod +x /go/src/github.com/chadgrant/go-tests.sh

WORKDIR /go/src/github.com/chadgrant/$application

COPY main.go /go/src/github.com/chadgrant/$application
COPY store /go/src/github.com/chadgrant/$application/store/
COPY data /go/src/github.com/chadgrant/$application/data/

RUN go get ./...

ENTRYPOINT "../go-tests.sh"